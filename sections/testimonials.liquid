<link rel="stylesheet" href="{{ 'brand-stats.css' | asset_url }}">
<div class="section brand-stats-parent">
  <div class="brand-stats-container">
    {% for block in section.blocks %}
      <div class="brand-stats-block">
        <p
          class="stat-number"
          data-value="{{ block.settings.heading | remove: ',' | remove: '+' }}"
        >
          0+
        </p>
        <p>{{ block.settings.subheading }}</p>
      </div>
      {% unless forloop.last %}
        <hr>
      {% endunless %}
    {% endfor %}
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const counters = document.querySelectorAll('.stat-number');

    const animateCounter = (el) => {
      const target = parseInt(el.getAttribute('data-value'));
      const duration = 2000;
      const startTime = performance.now();

      const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);

      const update = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = easeOutCubic(progress);

        const current = Math.floor(target * eased);
        el.textContent = current.toLocaleString() + '+';

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      };

      requestAnimationFrame(update);
    };

    const observer = new IntersectionObserver(
      (entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            animateCounter(entry.target);
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.6 }
    );

    counters.forEach((counter) => {
      observer.observe(counter);
    });
  });
</script>
{% schema %}
{
  "name": "Home Testimonials",
  "blocks": [
    {
      "type": "stats",
      "name": "Stats",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "100K+"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Happy Customers"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Home Testimonials"
    }
  ]
}
{% endschema %}
